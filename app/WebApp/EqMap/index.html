<!DOCTYPE html>
<html>
    <head>
        <title>yumin地震観測所┃震度分布図v1</title>
        <meta charset="UTF-8">
        <html lang="ja">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://kit.fontawesome.com/e9f92a9dd0.js" crossorigin="anonymous"></script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZL8HPL24E7"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-ZL8HPL24E7');
        </script>
        
        
        <!--OGP-->

        <meta name="description" content="yumin地震観測所の職員が開発した気象情報や地震情報を表示するWebAppです。" />
        <meta name="keywords" content="YQL,yumin地震観測所" />
        <meta property="og:title" content="yumin地震観測所┃震度分布図" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://www.yuminQuakelive.net/app/WebApp/EqMap/" />
        <meta property="og:site_name" content="yumin地震観測所┃WebApp" />
        <meta property="og:image" content="https://www.yuminQuakelive.net/imges/OGP/imge.png" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@yuminQuakelive" />

        <!--ファイル読み込み-->

        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin="" />
        <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
        <script src="source/static/js/leaflet-src.js"></script>
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="./source/static/font/fonts.css">
        <link rel="icon" href="../../../imges/YQL_-_icon_-_2022_-_model-removebg-preview.png">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0">
    </head>
    <body>
        <div id="map" class="background_nerv">
            <div class="leaflet-bottom leaflet-right">
                <div class="leaflet-control-attribution leaflet-control">
                    <a href="https://leafletjs.com" title="A JavaScript library for interactive maps">
                        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag">
                            <path fill="#4C7BE1" d="M0 0h12v4H0z"></path>
                            <path fill="#FFD500" d="M0 4h12v3H0z"></path>
                            <path fill="#E0BC00" d="M0 7h12v1H0z"></path>
                        </svg>
                        Leaflet</a>
                </div>
            </div>
        </div>
<<<<<<< HEAD
        <span class="footer">&copy;2022 - 2025 yuminQuakelive.┃地図データ：NaturalEarth┃Earthquake Information by P2PQuake┃Version：1.0.1β┃<a href="about/index.html" target="_blank">情報</a>　</span>
=======
        <span class="footer">&copy;2022 - 2024 yuminQuakelive.┃地図データ：NaturalEarth┃Earthquake Information by P2PQuake┃Version：1.0.1β┃<a href="about/index.html" target="_blank">情報</a>　</span>
>>>>>>> origin/main
        <div id="title">
            <div id="title_text">震度分布図</div>
            <div id="title_time">00<span class="small">月</span>00<span class="small">日</span> 00<span class="small">時</span>00<span class="small">分</span>00<span class="small">秒</span>現在</div>
        </div>
        <div id="info">
            <div class="maxint">最大震度<img src="source/jqk_int_.png"></div>
            00月00日 00時00分ころ<br>
            　震源地　：震源名<br>
            地震の規模：M0.0<br>
            震源の深さ：約00km<br>
            津波の心配：なし
        </div>
        <div class="btns">
            <div>
                <select id="quakelist" style="width: 25em;height: calc(2em + 5px);"><option>地震情報の取得中…</option></select>
                <span class="setsumei" style="padding: 0;padding-right: 5px;"><button id="reload">情報更新</button> <input type="number" id="reload_num" value="20" max="100">件</span>
                <button id="map_ichi">マップ再読み込み</button>
                <button id="test">テスト開始</button>
                <span class="setsumei autoreload_setsumei" style="padding: 0;padding-right: 5px;"><button id="autoreload">自動更新間隔</button> <input type="number" id="autoreload_num" value="10">秒</span>
                <input type="checkbox" name="shindoiconbig" id="shindoiconbig_check">
            </div>
            <div style="margin-top: 5px;">
                <span class="setsumei" id="theme_set" style="padding: 2px 5px;">テーマ 
                    <input type="radio" name="theme" id="theme_nerv" value="nerv" onchange="theme_change(this.value)" checked><label for="theme_nerv">NERV風</label>
                    <input type="radio" name="theme" id="theme_wni" value="wni" onchange="theme_change(this.value)"><label for="theme_wni">WNI風</label>
                    <input type="radio" name="theme" id="theme_quarog" value="quarog" onchange="theme_change(this.value)"><label for="theme_quarog">Quarog風</label>
                </span>
                <span class="setsumei" id="icon_theme_set" style="padding: 2px 5px;">アイコン 
                    <input type="radio" name="icon_theme" id="icon_theme_jqk" value="jqk" onchange="icon_theme_change(this.value)" checked>><label for="icon_theme_jqk">JQuake</label>
                    <input type="radio" name="icon_theme" id="icon_theme_ydits" value="ydits" onchange="icon_theme_change(this.value)"><label for="icon_theme_ydits">YDITS</label>
                </span>
                <span class="setsumei" id="display_onoff" style="padding: 2px 5px;">表示 
                    <input type="checkbox" name="shindo_ichiran" id="display_onoff_point_check" checked><label for="display_onoff_point_check">観測点</label>
                    <input type="checkbox" name="shindo_ichiran" id="display_onoff_fill_check" checked><label for="display_onoff_fill_check">塗りつぶし</label>
                    <input type="checkbox" name="shindo_ichiran" id="display_onoff_saibun_check" checked><label for="display_onoff_saibun_check">市区町村</label>
                </span>
                <span class="shindoichiran">
                    <input type="checkbox" name="shindo_ichiran" id="shindo_ichiran_check"><label for="shindo_ichiran_check">各地の震度</label>
                </span>
            </div>
        </div>
        <div id="shindo_ichiran">
            <div class="shindo_ichiran_title">各地の震度</div>
            <div id="shindoichiran_title_num">全 000<span class="small">ヶ所</span></div>
            <hr>
            <div id="shindo_">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int_.png"></div>
                <div id="shindo__article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo7">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int7.png"></div>
                <div id="shindo7_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo65">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int65.png"></div>
                <div id="shindo65_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo60">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int60.png"></div>
                <div id="shindo60_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo55">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int55.png"></div>
                <div id="shindo55_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo50">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int50.png"></div>
                <div id="shindo50_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo4">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int4.png"></div>
                <div id="shindo4_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo3">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int3.png"></div>
                <div id="shindo3_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo2">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int2.png"></div>
                <div id="shindo2_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
            <div id="shindo1">
                <div class="shindo_ichiran_kakutitle">震度<img src="source/jqk_int1.png"></div>
                <div id="shindo1_article"><ruby>○○市○○<rt>まるまるしまるまる</rt></ruby>　<ruby>△△市△△<rt>さんかくさんかくしさんかくさんかく</rt></ruby>　<ruby>□□町□□<rt>しかくしかくまちしかくしかく</rt></ruby></div>
                <hr>
            </div>
        </div>
        <div id="appinfo">
            <span class="material-symbols-outlined cap" id="info_closebtn">close</span>
        </div>
        <script src="source/JMAPoints.js"></script>
        <script src="source/static/js/SmoothWheelZoom.js"></script>
        <script>
            window.onload = function(){
                map_ichi
}
            //JQuakeの配色。使ってないかも
            var Color_1 = "#46646e";var MojiColor_1 = "#ffffff";var Color_2 = "#1e6ee6";var MojiColor_2 = "#ffffff";var Color_3 = "#00c8c8";var MojiColor_3 = "#000000";var Color_4 = "#ffff64";var MojiColor_4 = "#000000";var Color_50 = "#ffb400";var MojiColor_50 = "#000000";var Color_55 = "#ff7800";var MojiColor_55 = "#000000";var Color_60 = "#e60000";var MojiColor_60 = "#ffffff";var Color_65 = "#a00000";var MojiColor_65 = "#ffffff";var Color_7 = "#960096";var MojiColor_7 = "#ffffff";var Color_0 = "#008b8b";var MojiColor_0 = "#ffffff";
            //Leafletの定義
            var map = L.map('map',{
                center: [37.7102, 139.8132],
                zoom: 6,
                minZoom: 2,
                scrollWheelZoom: false,
                smoothWheelZoom: true,
                zoomControl: false // default true
            });
            
            //地図に表示させるポリゴンのスタイル
            var PolygonLayer_Style_nerv_1 = {
                "color": "#ffffff",
                "weight": 1.2,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_nerv_2 = {
                "color": "#999999",
                "weight": 1,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_nerv_3 = {
                "color": "#999999",
                "weight": 0.5,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_nerv_4 = {
                "opacity": 0,
                "fillColor": "#3a3a3a",
                "fillOpacity": 1,
            }
            var PolygonLayer_Style_wni_1 = {
                "color": "#000000",
                "weight": 0.5,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_wni_2 = {
                "color": "#ffffff",
                "weight": 1,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_wni_3 = {
                "color": "#999999",
                "weight": 0.4,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_wni_4 = {
                "opacity": 0,
                "fillColor": "#ffffff",
                "fillOpacity": 1,
            }
            var PolygonLayer_Style_quarog_1 = {
                "color": "#334948",
                "weight": 1.2,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_quarog_2 = {
                "color": "#334948",
                "weight": 1,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_quarog_3 = {
                "color": "#334948",
                "weight": 0.5,
                "opacity": 1,
                "fillOpacity": 0,
            }
            var PolygonLayer_Style_quarog_4 = {
                "opacity": 0,
                "fillColor": "#508C78",
                "fillOpacity": 1,
            }
            var PolygonLayer_Style_test_tsunami_1 = {
                "color": "#ff22ff",
                "weight": 5,
                "opacity": 1,
            }
            var PolygonLayer_Style_test_tsunami_2 = {
                "color": "#dd0000",
                "weight": 5,
                "opacity": 1,
            }
            var PolygonLayer_Style_test_tsunami_3 = {
                "color": "#dddd00",
                "weight": 5,
                "opacity": 1,
            }
            var PolygonLayer_Style_test_tsunami_4 = {
                "color": "#00dddd",
                "weight": 5,
                "opacity": 1,
            }
            //地図に表示させる上下の順番
            map.createPane("pane_map1").style.zIndex = 1; //地図（背景）
            map.createPane("pane_map2").style.zIndex = 2; //地図（市町村）
            map.createPane("pane_map3").style.zIndex = 3; //地図（細分）
            map.createPane("pane_map_filled").style.zIndex = 5; //塗りつぶし
            map.createPane("shindo10").style.zIndex = 10;
            map.createPane("shindo20").style.zIndex = 20;
            map.createPane("shindo30").style.zIndex = 30;
            map.createPane("shindo40").style.zIndex = 40;
            map.createPane("shindo45").style.zIndex = 45;
            map.createPane("shindo46").style.zIndex = 46;
            map.createPane("shindo50").style.zIndex = 50;
            map.createPane("shindo55").style.zIndex = 55;
            map.createPane("shindo60").style.zIndex = 60;
            map.createPane("shindo70").style.zIndex = 70;
            map.createPane("shingen").style.zIndex = 100; //震源
            map.createPane("tsunami_map").style.zIndex = 110; //津波
            Cookies.remove('visited');
            Cookies.set("saibun", true);
            var japan; //都道府県の枠線のみ
            var asia; //アジア地域高品質ポリゴン 
            var countries; //アジア地域を除く世界の低品質ポリゴン  
            var cities; //市区町村
            var japan_data; //都道府県データ
            var asia_data; //アジア地域高品質ポリゴンデータ 
            var countries_data; //アジア地域を除く世界の低品質ポリゴンデータ
            var cities_data; //市区町村データ
            var japan_back; //都道府県の枠線なし
            //地図データ読み込み
            $.getJSON("https://miyakocam.github.io/geojsons/asia.geojson", function (data) {
                asia_data = data;
                asia = L.geoJson(asia_data, {
                    pane: "pane_map3",
                    style: PolygonLayer_Style_nerv_2,
                }).addTo(map);
            });     
            $.getJSON("https://miyakocam.github.io/geojsons/countries.geojson", function (data) {
                countries_data = data;
                countries = L.geoJson(countries_data, {
                    pane: "pane_map3",
                    style: PolygonLayer_Style_nerv_2,
                }).addTo(map);
            });
            $.getJSON("https://miyakocam.github.io/geojsons/cities.geojson", function (data) {
                cities_data = data;
                cities = L.geoJson(cities_data, {
                    pane: "pane_map2",
                    style: PolygonLayer_Style_nerv_3,
                });
            });
            $.getJSON("https://miyakocam.github.io/geojsons/saibun.geojson", function (data) {
                japan_data = data;
                japan = L.geoJson(japan_data, {
                    pane: "pane_map3",
                    style: PolygonLayer_Style_nerv_1,
                }).addTo(map);
                japan_back = L.geoJson(japan_data, {
                    pane: "pane_map1",
                    style: PolygonLayer_Style_nerv_4,
                }).addTo(map);
            }); 
            
            //市区町村を表示させるかどうか
            citiesDraw();
            map.on('zoomend', function(e) {
                citiesDraw();
            });
            function citiesDraw() {
                if (cities && Cookies.get("drawMode") == "saibun") {
                    map.removeLayer(cities);
                } else if (cities && Cookies.get("saibun") == "true") {
                    if (map.getZoom() < 7) {
                        map.removeLayer(cities);
                    } else {
                        cities.addTo(map);
                    }
                } else if (cities) {
                    map.removeLayer(cities);
                }
            }
            
            //変数の定義(グローバルでやらないほうがいいらしい。でもやる。)
            var QuakeJson;
            var JMAPointsJson;
            var maxint;
            var shingen_icon;
            var shindo_layer = L.layerGroup();
            var shindo_filled_layer = L.layerGroup();
            var Filled;
            var test_on = "test_off";
            var shingen_lnglat;
            var fly_shingen_lnglat;
            var fly_shingen_lnglat_2;
            var gettime;
            var autoreload_onoff;
            var autoreload_onoff_num;
            var autoreload_interval;
            var icon_theme = "eqm";
            var this_theme = "nerv";
            var data_japan;
            var filled_list = {};
            var point_onoff = 1; //0:off, 1:on
            var fill_onoff = 1; //0:off, 1:on
            
            //設定を残しておくためのローカルストレージの設定
            if (localStorage.getItem('autoreload_onoff') == "off") {
                autoreload_onoff = "off";
            } else {
                document.getElementsByClassName('autoreload_setsumei')[0].classList.add('on');
                autoreload_onoff = "on";
                localStorage.setItem('autoreload_onoff','on');
            }
            if (localStorage.getItem('autoreload_onoff_num') == undefined) {
                autoreload_onoff_num = 10;
            } else {
                autoreload_onoff_num = localStorage.getItem('autoreload_onoff_num');
                document.getElementById('autoreload_num').value = localStorage.getItem('autoreload_onoff_num');
            }
            document.getElementById('info_closebtn').addEventListener("click", () => {
                document.getElementById('appinfo').classList.remove('display');
            });

            //地震情報リストをクリックしたときの発火イベント
            var list = document.getElementById('quakelist');
            list.onchange = event => {
                console.log(list.selectedIndex);
                QuakeSelect(list.selectedIndex);
            }
            
            //ボタン押下時のイベント設定とローカルストレージの設定
            document.getElementById('reload').addEventListener("click",()=>{
                var koushin_ok;
                var koushin;
                clearTimeout(koushin);
                clearTimeout(koushin_ok);
                if (test_on == "test_on") {
                    document.getElementById('test').click();
                }
                if (document.getElementById('reload_num').value != "") {
                    if (document.getElementById('reload_num').value > 100) {
                        GetQuake(100);
                    } else {
                        let num_kari = Math.abs(document.getElementById('reload_num').value);
                        GetQuake(num_kari);
                    }
                } else {
                    GetQuake();
                }
                document.getElementById('reload').innerText = "更新中…";
                koushin = setTimeout(() => {
                    document.getElementById('reload').innerText = "更新完了";
                    koushin_ok = setTimeout(() => {
                        document.getElementById('reload').innerText = "情報更新";
                    }, 1000);
                }, 1000);
            });
            document.getElementById('test').addEventListener("click",()=>{
                if (test_on == "test_off") {
                    test_on = "test_on";
                    document.getElementById('test').innerText = "テスト終了";
                } else {
                    test_on = "test_off";
                    document.getElementById('test').innerText = "テスト開始";
                }
                GetQuake(test_on);
            });
            document.getElementById('map_ichi').addEventListener("click",()=>{
                if (fly_shingen_lnglat != undefined && fly_shingen_lnglat != 0) {
                    if (document.getElementById('shindo_ichiran_check').checked) {
                        if (fly_shingen_lnglat_2 != undefined && fly_shingen_lnglat_2 != 0) {
                            map.flyTo(fly_shingen_lnglat_2, 8, { duration: 0.5 });
                        }
                    } else {
                        map.flyTo(fly_shingen_lnglat, 8, { duration: 0.5 });
                    }
                } else {
                    clearTimeout(syokikashippai);
                    document.getElementById('map_ichi').innerText = "初期化失敗";
                    var shokikashippai = setTimeout(() => {
                        document.getElementById('map_ichi').innerText = "位置初期化";
                    }, 1000);
                }
            });
            document.getElementById('shindo_ichiran_check').addEventListener("change",()=>{
                if (document.getElementById('shindo_ichiran_check').checked) {
                    document.getElementById('shindo_ichiran').classList.add('display');
                    if (fly_shingen_lnglat_2 != undefined && fly_shingen_lnglat_2 != 0) {
                        //map.flyTo(fly_shingen_lnglat_2, 7.5, { duration: 0.5 });
                        map.flyTo(fly_shingen_lnglat_2, 8, { duration: 0.5 });
                    }
                } else {
                    document.getElementById('shindo_ichiran').classList.add('display_none');
                    setTimeout(() => {
                        document.getElementById('shindo_ichiran').classList.remove('display_none');
                        document.getElementById('shindo_ichiran').classList.remove('display');
                    }, 450);
                    if (fly_shingen_lnglat != undefined && fly_shingen_lnglat != 0) {
                        //map.flyTo(fly_shingen_lnglat, 7.5, { duration: 0.5 });
                        map.flyTo(fly_shingen_lnglat, 8, { duration: 0.5 });
                    }
                }
            });
            document.getElementById('display_onoff_point_check').addEventListener("change",()=>{
                if (document.getElementById('display_onoff_point_check').checked) {
                    if (shindo_layer != undefined && shindo_layer != 0) {
                        map.addLayer(shindo_layer);
                        point_onoff = 1;
                    } else {
                        console.error('エラー： \"shindo_layer\" が見つからないため、観測点をマップに追加できません。');
                        point_onoff = 0;
                    }
                } else {
                    if (shindo_layer != undefined && shindo_layer != 0) {
                        map.removeLayer(shindo_layer);
                        point_onoff = 0;
                    } else {
                        console.error('エラー： \"shindo_layer\" が見つからないため、観測点をマップから削除できません。');
                        point_onoff = 1;
                    }
                }
            });
            document.getElementById('display_onoff_fill_check').addEventListener("change",()=>{
                if (document.getElementById('display_onoff_fill_check').checked) {
                    if (shindo_filled_layer != undefined && shindo_filled_layer != 0) {
                        map.addLayer(shindo_filled_layer);
                        fill_onoff = 1;
                    } else {
                        console.error('エラー： \"shindo_filled_layer\" が見つからないため、塗りつぶしをマップに追加できません。');
                        fill_onoff = 0;
                    }
                } else {
                    if (shindo_filled_layer != undefined && shindo_filled_layer != 0) {
                        map.removeLayer(shindo_filled_layer);
                        fill_onoff = 0;
                    } else {
                        console.error('エラー： \"shindo_filled_layer\" が見つからないため、塗りつぶしをマップから削除できません。');
                        fill_onoff = 1;
                    }
                }
            });
            document.getElementById('display_onoff_saibun_check').addEventListener("change",()=>{
                if (document.getElementById('display_onoff_saibun_check').checked) {
                    Cookies.set("saibun", true);
                } else {
                    Cookies.set("saibun", false);
                }
                citiesDraw();
            });
            document.getElementById('shindoiconbig_check').addEventListener("change",()=>{
                QuakeSelect(document.getElementById('quakelist').selectedIndex);
            });

            document.getElementById('autoreload').addEventListener("click",()=>{
                if (autoreload_onoff == "on") {
                    document.getElementsByClassName('autoreload_setsumei')[0].classList.remove('on');
                    autoreload_onoff = "off";
                    localStorage.setItem('autoreload_onoff','off');
                } else {
                    document.getElementsByClassName('autoreload_setsumei')[0].classList.add('on');
                    autoreload_onoff = "on";
                    localStorage.setItem('autoreload_onoff','on');
                }
                interval();
            });

            document.getElementById('autoreload_num').addEventListener("change",()=>{
                if (document.getElementById('autoreload_num').value <= 1) {
                    autoreload_onoff_num = 2;
                    localStorage.setItem('autoreload_onoff_num',autoreload_onoff_num);
                } else {
                    autoreload_onoff_num = document.getElementById('autoreload_num').value;
                    localStorage.setItem('autoreload_onoff_num',autoreload_onoff_num);
                }
                interval();
            });

            //地図テーマ変更時
            function theme_change(theme_name) {
                this_theme = theme_name;
                if (japan && asia && countries && cities && japan_back) {
                    map.removeLayer(japan);
                    map.removeLayer(japan_back);
                    map.removeLayer(asia);
                    map.removeLayer(countries);
                    map.removeLayer(cities);
                    eval('japan = L.geoJson(japan_data, {pane: "pane_map3",style: PolygonLayer_Style_'+theme_name+'_1,}).addTo(map);');
                    eval('japan_back = L.geoJson(japan_data, {pane: "pane_map1",style: PolygonLayer_Style_'+theme_name+'_4,}).addTo(map);');
                    eval('asia = L.geoJson(asia_data, {pane: "pane_map3",style: PolygonLayer_Style_'+theme_name+'_2,}).addTo(map);');
                    eval('countries = L.geoJson(countries_data, {pane: "pane_map3",style: PolygonLayer_Style_'+theme_name+'_2,}).addTo(map);');
                    if (map.getZoom() >= 7) {
                        eval('cities = L.geoJson(cities_data, {pane: "pane_map2",style: PolygonLayer_Style_'+theme_name+'_3,}).addTo(map);');
                    } else {
                        eval('cities = L.geoJson(cities_data, {pane: "pane_map2",style: PolygonLayer_Style_'+theme_name+'_3,});');
                    }
                    document.getElementById('map').classList.remove('background_nerv');
                    document.getElementById('map').classList.remove('background_wni');
                    document.getElementById('map').classList.remove('background_quarog');
                    eval("document.getElementById('map').classList.add('background_"+theme_name+"');");
                    QuakeSelect(document.getElementById('quakelist').selectedIndex);
                }
            }
            //震度配色の変更時
            function icon_theme_change(theme_name) {
                icon_theme = theme_name;
                QuakeSelect(document.getElementById('quakelist').selectedIndex);
            }

            //観測点の位置データなどのデータを取得
            async function GetJson() {
                const url = "source/JMAstations.json";
                const response = await fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        JMAPointsJson = data;
                    });
            }
            GetJson();

            //地震情報をP2PQuakeより取得
            //引数"option"は情報取得のボタンの件数か熊本県地震のテストデータを取得する文章
            async function GetQuake(option) {
                if (option == "test_on") {
                    var url = "https://api.p2pquake.net/v2/jma/quake?quake_type=DetailScale&min_scale=70&limit=5";
                } else if (!isNaN(option)) {
                    var url = "https://api.p2pquake.net/v2/history?codes=551&limit="+option;
                } else {
                    var url = "https://api.p2pquake.net/v2/history?codes=551&limit=20";
                }
                const response = await fetch(url)
                .then(response => response.json())
                .then(data => {
                    QuakeJson = data;
                    //現在の時刻を分解して○月○日形式にする
                    gettime = new Date();
                    var getmonth = ('0' + (gettime.getMonth() + 1)).slice(-2);
                    var getday = ('0' + gettime.getDate()).slice(-2);
                    var gethour = ('0' + gettime.getHours()).slice(-2);
                    var getminute = ('0' + gettime.getMinutes()).slice(-2);
                    var getsecond = ('0' + gettime.getSeconds()).slice(-2);
                    document.getElementById('title_time').innerHTML = getmonth+'<span class="small">月</span>'+getday+'<span class="small">日</span> '+gethour+'<span class="small">時</span>'+getminute+'<span class="small">分</span>'+getsecond+'<span class="small">秒</span>現在';
                    var int = 0;
                    //地震情報リストの中身をすべて削除する
                    while (list.lastChild) {
                        list.removeChild(list.lastChild);
                    }
                    //地震情報を地震情報リストに表示するための処理
                    //forEachは配列に入っているデータをすべて繰り返す。変数elementに一個ずつの配列が入る
                    QuakeJson.forEach(element => {
                        //震度の判定
                        if (element['earthquake']['maxScale'] == 10){
                            maxint = "1";
                        } else if (element['earthquake']['maxScale'] == 20) {
                            maxint = "2";
                        } else if (element['earthquake']['maxScale'] == 30) {
                            maxint = "3";
                        } else if (element['earthquake']['maxScale'] == 40) {
                            maxint = "4";
                        } else if (element['earthquake']['maxScale'] == 45 || element['earthquake']['maxScale'] == 46) {
                            maxint = "5弱";
                        } else if (element['earthquake']['maxScale'] == 50) {
                            maxint = "5強";
                        } else if (element['earthquake']['maxScale'] == 55) {
                            maxint = "6弱";
                        } else if (element['earthquake']['maxScale'] == 60) {
                            maxint = "6強";
                        } else if (element['earthquake']['maxScale'] == 70) {
                            maxint = "7";
                        } else {
                            maxint = "不明"
                        }
                        
                        var option = document.createElement("option");
                        var Kibo = Number(QuakeJson[int]["earthquake"]["hypocenter"]["magnitude"]).toFixed(1);
                        if (Kibo == -1) {
                            Kibo = "不明";
                        }
                        var text;
                        if (QuakeJson[int]["issue"]["type"] != "ScalePrompt" && QuakeJson[int]["issue"]["type"] != "Foreign") {
                            text = QuakeJson[int]["earthquake"]["time"].slice(0, -3) + " " + QuakeJson[int]["earthquake"]["hypocenter"]["name"] + " " +  "\n" + "\n最大震度 : " + maxint + " ";
                        } else if (QuakeJson[int]["issue"]["type"] == "Foreign") {
                            text = "【遠地地震】" + QuakeJson[int]["earthquake"]["time"].slice(0, -3) + " " + QuakeJson[int]["earthquake"]["hypocenter"]["name"];
                        } else {
                            text = "【震度速報】" + QuakeJson[int]["points"][0]["addr"] + "など " + "\n" + QuakeJson[int]["earthquake"]["time"].slice(0, -3) + "\n最大震度 : " + maxint + " ";
                        }
                        option.value = "" + int + "";
                        option.textContent = text;
                        list.appendChild(option);
                        int++;
                    });
                    setTimeout(() => {
                        //少し時間をおいてから地震情報を描画する(すぐだとまだ地震情報が取得できていない可能性があるため)
                        QuakeSelect(0);
                    }, 500);
                })
            }

            //地震情報の描画の処理
            //引数"num"には地震情報リストの上からの順番が入る(はじめは0)
            function QuakeSelect(num) {
                //今まであった震度をすべて消す
                if (shingen_icon && shindo_layer && shindo_filled_layer) {
                    map.removeLayer(shindo_layer);
                    shindo_layer = L.layerGroup();
                    map.removeLayer(shingen_icon);
                    shindo_icon = "";
                    map.removeLayer(shindo_filled_layer);
                    shindo_filled_layer = L.layerGroup();
                }
                //今まであった塗りつぶしをすべて消す
                map.eachLayer(function (layer) {
                    if (layer.myTag && layer.myTag === "Filled") {
                        map.removeLayer(layer)
                    }
                });

                filled_list = {};
                    //震源アイコンの定義
                    let shingenIcon = L.icon({
                        iconUrl: 'source/shingen.png',
                        iconSize: [40,40],
                        popupAnchor: [0,-40]
                    });
                    //震源の座標
                    shingen_lnglat = new L.LatLng(QuakeJson[num]["earthquake"]["hypocenter"]["latitude"], QuakeJson[num]["earthquake"]["hypocenter"]["longitude"]);
                    //震源のマーカー
                    shingen_icon = L.marker(shingen_lnglat, { icon: shingenIcon, pane: "shingen" }).addTo(map);
                    let maxint_image;
                    var maxint_text;
                    //震度アイコンの画像を判定
                    if (QuakeJson[num]['earthquake']['maxScale'] == 10){
                        maxint = "1";
                        maxint_text = "1";
                    } else if (QuakeJson[num]['earthquake']['maxScale'] == 20) {
                        maxint = "2";
                        maxint_text = "2";
                    } else if (QuakeJson[num]['earthquake']['maxScale'] == 30) {
                        maxint = "3";
                        maxint_text = "3";
                    } else if (QuakeJson[num]['earthquake']['maxScale'] == 40) {
                        maxint = "4";
                        maxint_text = "4";
                    } else if (QuakeJson[num]['earthquake']['maxScale'] == 45 || QuakeJson[num]['earthquake']['maxScale'] == 46) {
                        maxint = "50";
                        maxint_text = "5弱";
                    } else if (QuakeJson[num]['earthquake']['maxScale'] == 50) {
                        maxint = "55";
                        maxint_text = "5強";
                    } else if (QuakeJson[num]['earthquake']['maxScale'] == 55) {
                        maxint = "60";
                        maxint_text = "6弱";
                    } else if (QuakeJson[num]['earthquake']['maxScale'] == 60) {
                        maxint = "65";
                        maxint_text = "6強";
                    } else if (QuakeJson[num]['earthquake']['maxScale'] == 70) {
                        maxint = "7";
                        maxint_text = "7";
                    } else {
                        maxint = "_";
                        maxint_text = "不明";
                    }
                    maxint_image = '<img src="source/'+icon_theme+'_int'+maxint+'.png" alt="震度'+maxint_text+'" title="震度'+maxint_text+'">';
                    if (QuakeJson[num]['earthquake']['maxScale'] == -1) {
                        maxint_image = '<img src="source/'+icon_theme+'_int_.png" alt="震度'+maxint_text+'" title="震度'+maxint_text+'">';
                    }
                    //マグニチュードや深さなどの判定
                    var Magnitude;
                    if (QuakeJson[num]['earthquake']['hypocenter']['magnitude'] != -1) {
                        Magnitude = Number(QuakeJson[num]['earthquake']['hypocenter']['magnitude']).toFixed(1);
                    } else {
                        Magnitude = 'ー.ー';
                    }
                    var Name;
                    if (QuakeJson[num]['earthquake']['hypocenter']['name'] != "") {
                        Name = QuakeJson[num]['earthquake']['hypocenter']['name'];
                    } else {
                        Name = '情報なし';
                    }
                    var depth;
                    depth = "約"+QuakeJson[num]['earthquake']['hypocenter']['depth']+"km";
                    if (QuakeJson[num]['earthquake']['hypocenter']['depth'] == -1) {
                        depth = '不明'
                    }
                    var tsunami_text;
                    if (QuakeJson[num]['earthquake']['domesticTsunami'] == "None") {
                        tsunami_text = "なし";
                    } else if (QuakeJson[num]['earthquake']['domesticTsunami'] == "Unknown") {
                        tsunami_text = "不明";
                    } else if (QuakeJson[num]['earthquake']['domesticTsunami'] == "Checking") {
                        tsunami_text = "調査中";
                    } else if (QuakeJson[num]['earthquake']['domesticTsunami'] == "NonEffective") {
                        tsunami_text = "若干の海面変動";
                    } else if (QuakeJson[num]['earthquake']['domesticTsunami'] == "Watch") {
                        tsunami_text = "津波注意報";
                    } else if (QuakeJson[num]['earthquake']['domesticTsunami'] == "Warning") {
                        tsunami_text = "津波警報";
                    } else {
                        tsunami_text = "情報なし";
                    }
                    //すべてを結合して震源アイコンを地図に表示
                    shingen_icon.bindPopup('発生時刻：'+(QuakeJson[num]['earthquake']['time'])+'<br>最大震度：'+maxint_text+'<br>震源地：'+Name+'<span style=\"font-size: 85%;\"> ('+QuakeJson[num]["earthquake"]["hypocenter"]["longitude"]+", "+QuakeJson[num]["earthquake"]["hypocenter"]["latitude"]+')</span><br>規模：M'+Magnitude+'　深さ：'+depth+'<br>受信：'+QuakeJson[num]['issue']['time']+', '+QuakeJson[num]['issue']['source'],{closeButton: false, zIndexOffset: 10000});
                    //震源アイコンにマウスが乗ったときにポップアップを表示
                    //thisは震源アイコンのこと
                    shingen_icon.on('mouseover', function (e) {
                        this.openPopup();
                    });
                    shingen_icon.on('mouseout', function (e) {
                        this.closePopup();
                    });
                    //左上の情報ボックスに表示する内容
                    var datekari = QuakeJson[num]['earthquake']['time'];
                    let info_1danme = '<div class="maxint">最大震度'+maxint_image+'</div>';
                    let info_2danme = datekari.substring(5,7)+'月'+datekari.substring(8,10)+'日 '+datekari.substring(11,13)+'時'+datekari.substring(14,16)+'分ごろ' +'<br>';
                    let info_3danme = '　震源地　：'+Name +'<br>';
                    let info_4danme = '地震の規模：M'+Magnitude +'<br>';
                    let info_5danme = '震源の深さ：'+depth +'<br>';
                    let info_6danme = '津波の心配：'+tsunami_text;
                    document.getElementById('info').innerHTML = info_1danme + info_2danme + info_3danme + info_4danme + info_5danme + info_6danme;
                    
                    //震度一覧の情報の全消去
                    //ここはもう少しコンパクトに行けたかも
                    document.getElementById('shindo1').classList.remove('display');
                    document.getElementById('shindo2').classList.remove('display');
                    document.getElementById('shindo3').classList.remove('display');
                    document.getElementById('shindo4').classList.remove('display');
                    document.getElementById('shindo50').classList.remove('display');
                    document.getElementById('shindo55').classList.remove('display');
                    document.getElementById('shindo60').classList.remove('display');
                    document.getElementById('shindo65').classList.remove('display');
                    document.getElementById('shindo7').classList.remove('display');
                    document.getElementById('shindo_').classList.remove('display');
                    document.getElementById('shindo1_article').innerHTML = "";
                    document.getElementById('shindo2_article').innerHTML = "";
                    document.getElementById('shindo3_article').innerHTML = "";
                    document.getElementById('shindo4_article').innerHTML = "";
                    document.getElementById('shindo50_article').innerHTML = "";
                    document.getElementById('shindo55_article').innerHTML = "";
                    document.getElementById('shindo60_article').innerHTML = "";
                    document.getElementById('shindo65_article').innerHTML = "";
                    document.getElementById('shindo7_article').innerHTML = "";
                    document.getElementById('shindo__article').innerHTML = "";

                    //震度一覧の数が何個あったか
                    var maxint__num = 0;
                    var maxint1_num = 0;
                    var maxint2_num = 0;
                    var maxint3_num = 0;
                    var maxint4_num = 0;
                    var maxint50_num = 0;
                    var maxint55_num = 0;
                    var maxint60_num = 0;
                    var maxint65_num = 0;
                    var maxint7_num = 0;
                    
                    if (QuakeJson[num]["issue"]["type"] != "ScalePrompt") { //各地の震度に関する情報
                        document.getElementById('title_text').innerText = "震度分布図 - 観測点モード";
                        Cookies.set("drawMode", "point");
                        //通常時の位置初期化の位置
                        fly_shingen_lnglat = new L.LatLng(Number(QuakeJson[num]["earthquake"]["hypocenter"]["latitude"]), Number(QuakeJson[num]["earthquake"]["hypocenter"]["longitude"]) - 1);
                        //震度一覧を開いているときの位置初期化の位置
                        fly_shingen_lnglat_2 = new L.LatLng(Number(QuakeJson[num]["earthquake"]["hypocenter"]["latitude"]), Number(QuakeJson[num]["earthquake"]["hypocenter"]["longitude"]) + 0.5);
                        //観測点の震度についてすべての観測点に対して繰り返す
                        QuakeJson[num]["points"].forEach(element => {
                            var result = JMAPoints.indexOf(element["addr"]);
                            if (result != -1) {
                                var ImgUrl = "";
                                var PointShindo = "";
                                var PointColor;
                                var shindo_ichiran_doko;
                                if (element["scale"] == 10) {
                                    eval('PointColor = '+icon_theme+'_backColor_1');
                                    ImgUrl = "source/"+icon_theme+"_int1.png";
                                    PointShindo = "震度1";
                                    shindo_ichiran_doko = "document.getElementById('shindo1_article')";
                                    maxint1_num++;
                                } else if (element["scale"] == 20) {
                                    eval('PointColor = '+icon_theme+'_backColor_2');
                                    ImgUrl = "source/"+icon_theme+"_int2.png";
                                    PointShindo = "震度2";
                                    shindo_ichiran_doko = "document.getElementById('shindo2_article')";
                                    maxint2_num++;
                                } else if (element["scale"] == 30) {
                                    eval('PointColor = '+icon_theme+'_backColor_3');
                                    ImgUrl = "source/"+icon_theme+"_int3.png";
                                    PointShindo = "震度3";
                                    shindo_ichiran_doko = "document.getElementById('shindo3_article')";
                                    maxint3_num++;
                                } else if (element["scale"] == 40) {
                                    eval('PointColor = '+icon_theme+'_backColor_4');
                                    ImgUrl = "source/"+icon_theme+"_int4.png";
                                    PointShindo = "震度4";
                                    shindo_ichiran_doko = "document.getElementById('shindo4_article')";
                                    maxint4_num++;
                                } else if (element["scale"] == 45) {
                                    eval('PointColor = '+icon_theme+'_backColor_50');
                                    ImgUrl = "source/"+icon_theme+"_int50.png";
                                    PointShindo = "震度5弱";
                                    shindo_ichiran_doko = "document.getElementById('shindo50_article')";
                                    maxint50_num++;
                                } else if (element["scale"] == 46) {
                                    eval('PointColor = '+icon_theme+'_backColor_50');
                                    ImgUrl = "source/"+icon_theme+"_int50.png";
                                    PointShindo = "震度5弱以上と推定";
                                    shindo_ichiran_doko = "document.getElementById('shindo50_article')";
                                    maxint50_num++;
                                } else if (element["scale"] == 50) {
                                    eval('PointColor = '+icon_theme+'_backColor_55');
                                    ImgUrl = "source/"+icon_theme+"_int55.png";
                                    PointShindo = "震度5強";
                                    shindo_ichiran_doko = "document.getElementById('shindo55_article')";
                                    maxint55_num++;
                                } else if (element["scale"] == 55) {
                                    eval('PointColor = '+icon_theme+'_backColor_60');
                                    ImgUrl = "source/"+icon_theme+"_int60.png";
                                    PointShindo = "震度6弱";
                                    shindo_ichiran_doko = "document.getElementById('shindo60_article')";
                                    maxint60_num++;
                                } else if (element["scale"] == 60) {
                                    eval('PointColor = '+icon_theme+'_backColor_65');
                                    ImgUrl = "source/"+icon_theme+"_int65.png";
                                    PointShindo = "震度6強";
                                    shindo_ichiran_doko = "document.getElementById('shindo65_article')";
                                    maxint65_num++;
                                } else if (element["scale"] == 70) {
                                    eval('PointColor = '+icon_theme+'_backColor_7');
                                    ImgUrl = "source/"+icon_theme+"_int7.png";
                                    PointShindo = "震度7";
                                    shindo_ichiran_doko = "document.getElementById('shindo7_article')";
                                    maxint7_num++;
                                } else {
                                    eval('PointColor = '+icon_theme+'_backColor__');
                                    ImgUrl = "source/"+icon_theme+"_int_.png";
                                    PointShindo = "震度不明";
                                    shindo_ichiran_doko = "document.getElementById('shindo__article')";
                                    maxint__num++;
                                }

                                eval(shindo_ichiran_doko+'.innerHTML += "<ruby>'+element["addr"] + '<rt>' + JMAPointsJson[result]["furigana"] + '</rt></ruby>　"');

                                if (element["isArea"] == false) { //観測点
                                    let shindo_latlng = new L.LatLng(JMAPointsJson[result]["lat"], JMAPointsJson[result]["lon"]);
                                    let shindoIcon = L.icon({
                                        iconUrl: ImgUrl,
                                        iconSize: [20, 20],
                                        popupAnchor: [0, -40]
                                    });
                                    let shindoIcon_big = L.icon({
                                        iconUrl: ImgUrl,
                                        iconSize: [34, 34],
                                        popupAnchor: [0, -40]
                                    });
                                    var shindo_icon;
                                    if (document.getElementById('shindoiconbig_check').checked) {
                                        shindo_icon = L.marker(shindo_latlng, { icon: shindoIcon_big,pane: eval('\"shindo'+element["scale"]+'\"') });
                                    } else {
                                        shindo_icon = L.marker(shindo_latlng, { icon: shindoIcon,pane: eval('\"shindo'+element["scale"]+'\"') });
                                    }
                                    shindo_icon.bindPopup('<ruby>'+element["addr"] + '<rt style="font-size: 0.7em;">' + JMAPointsJson[result]["furigana"] + '</rt></ruby>　'+ PointShindo,{closeButton: false, zIndexOffset: 10000,autoPan: false,});
                                    shindo_icon.on('mouseover', function (e) {
                                        this.openPopup();
                                    });
                                    shindo_icon.on('mouseout', function (e) {
                                        this.closePopup();
                                    });
                                    shindo_layer.addLayer(shindo_icon);
                                    console.log(element["addr"] + " " + PointShindo + " OK");
                                    
                                    //塗りつぶしの設定をする
                                    //AreaNameToCode()は下を参照。大阪府北部を520等に変換
                                    //filled_listは連想配列で{520: 10, 120: 20}など、エリアコード: 震度の大きさ
                                    var areaCode = AreaNameToCode(JMAPointsJson[result]["area"]["name"]);
                                    //filled_listにエリアコードがなかったり、さらに大きな震度になっていたら更新
                                    if ((!filled_list[areaCode]) || filled_list[areaCode] < element["scale"]) {
                                        filled_list[areaCode] = element["scale"];
                                    }
                                }
                            }
                            
                        });
                        //for(... in ...)もforEachと同等。keyに連想配列の名前が入る
                        for (key in filled_list){ 
                            var PointColor;
                            if (filled_list[key] == 10) {
                                eval('PointColor = '+icon_theme+'_backColor_1');
                            } else if (filled_list[key] == 20) {
                                eval('PointColor = '+icon_theme+'_backColor_2');
                            } else if (filled_list[key] == 30) {
                                eval('PointColor = '+icon_theme+'_backColor_3');
                            } else if (filled_list[key] == 40) {
                                eval('PointColor = '+icon_theme+'_backColor_4');
                            } else if (filled_list[key] == 45) {
                                eval('PointColor = '+icon_theme+'_backColor_50');
                            } else if (filled_list[key] == 46) {
                                eval('PointColor = '+icon_theme+'_backColor_50');
                            } else if (filled_list[key] == 50) {
                                eval('PointColor = '+icon_theme+'_backColor_55');
                            } else if (filled_list[key] == 55) {
                                eval('PointColor = '+icon_theme+'_backColor_60');
                            } else if (filled_list[key] == 60) {
                                eval('PointColor = '+icon_theme+'_backColor_65');
                            } else if (filled_list[key] == 70) {
                                eval('PointColor = '+icon_theme+'_backColor_7');
                            }
                            //引数"key"はエリアコード、"PointColor"は塗りつぶし色のHEX値
                            FillPolygon(key, PointColor);
                        }
                    } else { //震度速報
                        document.getElementById('title_text').innerText = "震度速報 - 細分区域モード";
                        Cookies.set("drawMode", "saibun");
                        var latlon;
                        var latList = [];
                        var lonList = [];
                        QuakeJson[num]["points"].forEach(element => {
                            var ImgUrl = "";
                            var PointShindo = "";
                            var PointColor;
                            var shindo_ichiran_doko;
                            if (element["scale"] == 10) {
                                eval('PointColor = '+icon_theme+'_backColor_1');
                                ImgUrl = "source/"+icon_theme+"_int1.png";
                                PointShindo = "震度1";
                                shindo_ichiran_doko = "document.getElementById('shindo1_article')";
                                maxint1_num++;
                            } else if (element["scale"] == 20) {
                                eval('PointColor = '+icon_theme+'_backColor_2');
                                ImgUrl = "source/"+icon_theme+"_int2.png";
                                PointShindo = "震度2";
                                shindo_ichiran_doko = "document.getElementById('shindo2_article')";
                                maxint2_num++;
                            } else if (element["scale"] == 30) {
                                eval('PointColor = '+icon_theme+'_backColor_3');
                                ImgUrl = "source/"+icon_theme+"_int3.png";
                                PointShindo = "震度3";
                                shindo_ichiran_doko = "document.getElementById('shindo3_article')";
                                maxint3_num++;
                            } else if (element["scale"] == 40) {
                                eval('PointColor = '+icon_theme+'_backColor_4');
                                ImgUrl = "source/"+icon_theme+"_int4.png";
                                PointShindo = "震度4";
                                shindo_ichiran_doko = "document.getElementById('shindo4_article')";
                                maxint4_num++;
                            } else if (element["scale"] == 45) {
                                eval('PointColor = '+icon_theme+'_backColor_50');
                                ImgUrl = "source/"+icon_theme+"_int50.png";
                                PointShindo = "震度5弱";
                                shindo_ichiran_doko = "document.getElementById('shindo50_article')";
                                maxint50_num++;
                            } else if (element["scale"] == 46) {
                                eval('PointColor = '+icon_theme+'_backColor_50');
                                ImgUrl = "source/"+icon_theme+"_int50.png";
                                PointShindo = "震度5弱以上と推定";
                                shindo_ichiran_doko = "document.getElementById('shindo50_article')";
                                maxint50_num++;
                            } else if (element["scale"] == 50) {
                                eval('PointColor = '+icon_theme+'_backColor_55');
                                ImgUrl = "source/"+icon_theme+"_int55.png";
                                PointShindo = "震度5強";
                                shindo_ichiran_doko = "document.getElementById('shindo55_article')";
                                maxint55_num++;
                            } else if (element["scale"] == 55) {
                                eval('PointColor = '+icon_theme+'_backColor_60');
                                ImgUrl = "source/"+icon_theme+"_int60.png";
                                PointShindo = "震度6弱";
                                shindo_ichiran_doko = "document.getElementById('shindo60_article')";
                                maxint60_num++;
                            } else if (element["scale"] == 60) {
                                eval('PointColor = '+icon_theme+'_backColor_65');
                                ImgUrl = "source/"+icon_theme+"_int65.png";
                                PointShindo = "震度6強";
                                shindo_ichiran_doko = "document.getElementById('shindo65_article')";
                                maxint65_num++;
                            } else if (element["scale"] == 70) {
                                eval('PointColor = '+icon_theme+'_backColor_7');
                                ImgUrl = "source/"+icon_theme+"_int7.png";
                                PointShindo = "震度7";
                                shindo_ichiran_doko = "document.getElementById('shindo7_article')";
                                maxint7_num++;
                            } else {
                                eval('PointColor = '+icon_theme+'_backColor__');
                                ImgUrl = "source/"+icon_theme+"_int_.png";
                                PointShindo = "震度不明";
                                shindo_ichiran_doko = "document.getElementById('shindo__article')";
                                maxint__num++;
                            }
                            eval(shindo_ichiran_doko+'.innerHTML += "'+element["addr"]+'　"');
                            var area_Code = AreaNameToCode(element["addr"]);
                            latlon = FillPolygon(area_Code, PointColor);
                            latList.push(Number(latlon["lat"]));
                            lonList.push(Number(latlon["lng"]));
                            let shindoIcon = L.icon({
                                iconUrl: ImgUrl,
                                iconSize: [30, 30],
                                popupAnchor: [0, -50]
                            });
                            var shindo_icon = L.marker(latlon, { icon: shindoIcon,pane: eval('\"shindo'+element["scale"]+'\"') });
                            shindo_icon.bindPopup(element["addr"]+ '　'+ PointShindo,{closeButton: false, zIndexOffset: 10000,autoPan: false,});
                            shindo_icon.on('mouseover', function (e) {
                                this.openPopup();
                            });
                            shindo_icon.on('mouseout', function (e) {
                                this.closePopup();
                            });
                            shindo_layer.addLayer(shindo_icon);
                            console.log(element["addr"] + " " + PointShindo + " OK");
                        });
                        var latList_num = Math.floor((latList.length) / 2);
                        var lonList_num = Math.floor((lonList.length) / 2);
                        console.log(latList_num+" "+lonList_num)
                        fly_shingen_lnglat = new L.LatLng(Number(latList[latList_num]), Number(lonList[lonList_num]) - 1);
                        fly_shingen_lnglat_2 = new L.LatLng(Number(latList[latList_num]), Number(lonList[lonList_num]) + 0.5);
                        latList = [];
                        lonList = [];
                    }
                    let shindo_ichiran_kakutitle = document.getElementsByClassName('shindo_ichiran_kakutitle');
                    let shindo_ichiran_kakutitle_1 = '震度<img src="source/'+icon_theme+'_int';
                    let shindo_ichiran_kakutitle_2 = '<span class="kasho_small">ヶ所</span>';
                    shindo_ichiran_kakutitle[0].innerHTML = shindo_ichiran_kakutitle_1+'_.png">　'+maxint__num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[1].innerHTML = shindo_ichiran_kakutitle_1+'7.png">　'+maxint7_num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[2].innerHTML = shindo_ichiran_kakutitle_1+'65.png">　'+maxint65_num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[3].innerHTML = shindo_ichiran_kakutitle_1+'60.png">　'+maxint60_num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[4].innerHTML = shindo_ichiran_kakutitle_1+'55.png">　'+maxint55_num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[5].innerHTML = shindo_ichiran_kakutitle_1+'50.png">　'+maxint50_num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[6].innerHTML = shindo_ichiran_kakutitle_1+'4.png">　'+maxint4_num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[7].innerHTML = shindo_ichiran_kakutitle_1+'3.png">　'+maxint3_num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[8].innerHTML = shindo_ichiran_kakutitle_1+'2.png">　'+maxint2_num+shindo_ichiran_kakutitle_2;
                    shindo_ichiran_kakutitle[9].innerHTML = shindo_ichiran_kakutitle_1+'1.png">　'+maxint1_num+shindo_ichiran_kakutitle_2;
                    let maxint_sum = maxint__num+maxint1_num+maxint2_num+maxint3_num+maxint4_num+maxint50_num+maxint55_num+maxint60_num+maxint65_num+maxint7_num;
                    document.getElementById('shindoichiran_title_num').innerHTML = '全 '+maxint_sum+'<span class="small">ヶ所</span>';
                    if (document.getElementById('shindo1_article').innerHTML == "") {document.getElementById('shindo1').classList.add('display')}
                    if (document.getElementById('shindo2_article').innerHTML == "") {document.getElementById('shindo2').classList.add('display')}
                    if (document.getElementById('shindo3_article').innerHTML == "") {document.getElementById('shindo3').classList.add('display')}
                    if (document.getElementById('shindo4_article').innerHTML == "") {document.getElementById('shindo4').classList.add('display')}
                    if (document.getElementById('shindo50_article').innerHTML == "") {document.getElementById('shindo50').classList.add('display')}
                    if (document.getElementById('shindo55_article').innerHTML == "") {document.getElementById('shindo55').classList.add('display')}
                    if (document.getElementById('shindo60_article').innerHTML == "") {document.getElementById('shindo60').classList.add('display')}
                    if (document.getElementById('shindo65_article').innerHTML == "") {document.getElementById('shindo65').classList.add('display')}
                    if (document.getElementById('shindo7_article').innerHTML == "") {document.getElementById('shindo7').classList.add('display')}
                    if (document.getElementById('shindo__article').innerHTML == "") {document.getElementById('shindo_').classList.add('display')}
                    
                    if (point_onoff == 1) {
                        map.addLayer(shindo_layer);
                    }
                    if (fill_onoff == 1) {
                        map.addLayer(shindo_filled_layer);
                    }

                    if (document.getElementById('shindo_ichiran_check').checked) {
                        if (fly_shingen_lnglat_2 != undefined && fly_shingen_lnglat_2 != 0) {
                            //map.flyTo(fly_shingen_lnglat_2, 7.5, { duration: 0.5 });
                            map.flyTo(fly_shingen_lnglat_2, 8, { duration: 0.5 })
                        }
                    } else {
                        //map.flyTo(fly_shingen_lnglat, 7.5, { duration: 0.5 });
                        map.flyTo(fly_shingen_lnglat, 8, { duration: 0.5 })
                    }
                    Cookies.set('visited','already');
                
            }

            GetQuake();
            function interval() {
                autoreload_onoff_num_get();
                autoreload_onoff_num *= 1000;
                if (autoreload_onoff == "on") {
                    if (autoreload_interval != null || autoreload_interval != 0) {
                        clearInterval(autoreload_interval);
                        autoreload_interval = null;
                    }
                    autoreload_interval = setInterval(() => {
                        if (autoreload_onoff_num <= 3000) {
                            GetQuake();
                        } else {
                            document.getElementById('reload').click();
                        }
                    }, autoreload_onoff_num);
                } else {
                    clearInterval(autoreload_interval);
                    autoreload_interval = null;
                }
            }
            if (autoreload_onoff == "on") {
                interval();
            }
            function autoreload_onoff_num_get(){
                if (localStorage.getItem('autoreload_onoff_num')){
                    autoreload_onoff_num = localStorage.getItem('autoreload_onoff_num');
                } else {
                    autoreload_onoff_num = 10;
                }
                
            }

            function AreaNameToCode(Name) {
                var array_Num = AreaName.indexOf(Name);
                return AreaCode[array_Num];
            }
            function AreaCodeToName(code) {
                var array_Num = AreaCode.indexOf(code);
                return AreaName[array_Num];
            }

            function FillPolygon(area_Code, PointColor) {
                var array_Num = AreaCode.indexOf(area_Code);
                if (array_Num != -1) {
                    var style;
                    if (this_theme == "nerv") {
                        style = {
                            "color": "#ffffff",
                            "weight": 1.2,
                            "opacity": 1,
                            "fillColor": PointColor,
                            "fillOpacity": 1,
                        }
                    } else if (this_theme == "wni") {
                        style = {
                            "color": "#000000",
                            "weight": 0.8,
                            "opacity": 1,
                            "fillColor": PointColor,
                            "fillOpacity": 1,
                        }
                    } else if (this_theme == "quarog") {
                        style = {
                            "color": "#334948",
                            "weight": 1.2,
                            "opacity": 1,
                            "fillColor": PointColor,
                            "fillOpacity": 1,
                        }
                    }
                    data_japan = japan_data["features"][array_Num];
                    Filled_Layer = L.geoJSON(data_japan, {
                        style: style,
                        pane: "pane_map_filled",
                        onEachFeature: function (feature, layer) {
                            if (feature.properties && feature.properties.popupContent) {
                                layer.bindPopup(feature.properties.popupContent);
                            }
                            layer.myTag = "Filled"
                        },
                    });
                    shindo_filled_layer.addLayer(Filled_Layer);
                    map.addLayer(Filled_Layer);
                    var geodata = data_japan["geometry"]["coordinates"][0];
                    let latlon;
                    map.eachLayer(function (layer) {
                        if (layer.myTag && layer.myTag === "Filled") {
                            latlon = layer.getCenter();
                        }
                    });
                    map.removeLayer(Filled_Layer);
                    return latlon;
                }
            }
        </script>
    </body>
</html>